{"version":3,"sources":["assets\\Script\\RenderAlternativeItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import RenderAlternative from \"./RenderAlternative\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\n/**\r\n * 渲染分层Item挂载组件\r\n * 处理渲染分层Item的渲染分层\r\n */\r\nexport default class RenderAlternativeItem extends cc.Component {\r\n\r\n    /**是否初始化过代理组建 */\r\n    private hasInit: boolean = false;\r\n    /**渲染分层开启的挂载节点 */\r\n    public renderLayer: cc.Node;\r\n    /**初始化 */\r\n    public initRenderLayer(renderLayer: cc.Node) {\r\n        if (this.renderLayer != renderLayer) {\r\n            this.renderLayer = renderLayer;\r\n            renderLayer && this.initRenders();\r\n        }\r\n    }\r\n    /**\r\n     * 处理分层代理渲染\r\n     */\r\n    private initRenders() {\r\n        if (!this.hasInit && this.renderLayer) {\r\n            //\r\n            let propMap: WeakMap<RenderAlternative, boolean> = new WeakMap();\r\n            let keys = Object.keys(this);\r\n            for (let i = 0, len = keys.length; i < len; ++i) {\r\n                let value = this[keys[i]];\r\n                let alternative: RenderAlternative = null;\r\n                if (value instanceof cc.Node) {\r\n                    alternative = value.getComponent(RenderAlternative);\r\n                    if (alternative) {\r\n                        alternative.init(this.renderLayer);\r\n                    }\r\n                } else if (value instanceof cc.RenderComponent) {\r\n                    alternative = value.getComponent(RenderAlternative);\r\n                    if (alternative) {\r\n                        this[keys[i]] = alternative.init<typeof value>(this.renderLayer);\r\n                    }\r\n                }\r\n                alternative && propMap.set(alternative, true);\r\n            }\r\n            this.dealChilrenAlternative(this.node, propMap, 0, 0);\r\n            this.hasInit = true;\r\n        }\r\n    }\r\n    /**\r\n     * 处理子节点代理\r\n     * @param node \r\n     * @param propMap 记录脚本已经处理过的属性代理\r\n     * @param parentSindex 父节点的所在的顺序\r\n     * @param depth 深度\r\n     */\r\n    dealChilrenAlternative(node: cc.Node, propMap: WeakMap<RenderAlternative, boolean>, parentSindex: number, depth: number) {\r\n        for (let i = 0, len = node.children.length; i < len; i++) {\r\n            let children = node.children[i];\r\n            let alternative = children.getComponent(cc.RenderComponent)?.getComponent(RenderAlternative);\r\n            let sIndex = parentSindex + (i * Math.pow(0.1, depth));\r\n            if (alternative) {\r\n                if ((!propMap.has(alternative) || !propMap.get(alternative))) {\r\n                    alternative.init(this.renderLayer);\r\n                }\r\n                alternative.sIndex = sIndex;\r\n            }\r\n            this.dealChilrenAlternative(children, propMap, sIndex, depth + 1);\r\n        }\r\n    }\r\n}\r\n"]}