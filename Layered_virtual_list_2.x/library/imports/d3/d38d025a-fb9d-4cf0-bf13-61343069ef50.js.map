{"version":3,"sources":["assets\\Script\\RenderReactiveHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nexport function isObject(value: unknown): value is Record<any, any> {\r\n    return value !== null && typeof value === 'object';\r\n}\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\n/** 是否自身上存在属性 */\r\nexport function hasOwn(val: object, key: string | number | symbol): key is keyof typeof val {\r\n    if (val instanceof cc.Component) {\r\n        return key in val;\r\n    }\r\n    return hasOwnProperty.call(val, key);\r\n}\r\n\r\n/** 比较值是否变化了，考虑NaN；如果是对象直接认为改变了 */\r\nexport function hasChanged(value: any, oldValue: any): boolean {\r\n    let type = typeof value;\r\n    if (type === \"object\") return true;\r\n    return !Object.is(value, oldValue);\r\n}\r\n\r\n\r\nexport class RenderReactiveHandler {\r\n    constructor(reactiveTarget?: object) {\r\n        this.reactiveTarget = reactiveTarget;\r\n    }\r\n    /**需要作出反应的对象 */\r\n    private reactiveTarget: object = null;\r\n\r\n    /**\r\n     * \r\n     * @param target 被代理的对象\r\n     * @param prop 被代理的对象的属性名\r\n     * @param value 被代理的对象的属性值\r\n     * @param receiver 代理对象\r\n     * @returns \r\n     */\r\n    set(target: object, prop: string | symbol, value: any, receiver: any): boolean {\r\n\r\n        let oldValue = Reflect.get(target, prop);\r\n        let hadKey = hasOwn(target, prop);\r\n        let result = Reflect.set(target, prop, value);\r\n        if (!hadKey || hasChanged(value, oldValue)) {\r\n            if (prop == \"angle\" || prop == 'scale' || prop == \"position\" || prop == \"_renderFlag\") return;\r\n            if (prop == 'activeInHierarchy') {\r\n                console.warn(target);\r\n            }\r\n            // 属性变化\r\n            this.reactiveTarget && (Reflect.set(this.reactiveTarget, prop, value));\r\n        }\r\n\r\n        return result\r\n    }\r\n\r\n    apply() {\r\n        console.warn(arguments)\r\n    }\r\n\r\n    get(target: object, prop: string | symbol, receiver: any): any {\r\n\r\n        if (prop === '__raw__') {\r\n            return target;\r\n        }\r\n        else if (prop === '__isReactive__') {\r\n            return true;\r\n        }\r\n        let rawValue = Reflect.get(target, prop);\r\n        return rawValue;\r\n    }\r\n\r\n    deleteProperty(target: object, prop: string | symbol): boolean {\r\n        let hadKey = hasOwn(target, prop);\r\n        let oldValue = target[prop];\r\n        let result = Reflect.deleteProperty(target, prop);\r\n        if (result && hadKey) {\r\n            //trigger(target, prop, void 0, oldValue);\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n"]}